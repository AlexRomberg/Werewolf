import{i as N,j as se}from"./chunk-MBABEOSW.js";import{P as ee,V as te,a as l,b as C,c as re,e as r}from"./chunk-S6VIYWOS.js";var c=class{api;constructor(t){this.api=t}getRequest(t){return r(this,null,function*(){return yield this.api.makeRequest("GET",t)})}postRequest(t,e,s=void 0){return r(this,null,function*(){return yield this.api.makeRequest("POST",t,e,s)})}putRequest(t,e,s=void 0){return r(this,null,function*(){return yield this.api.makeRequest("PUT",t,e,s)})}deleteRequest(t,e){return r(this,null,function*(){return yield this.api.makeRequest("DELETE",t,e)})}paramsFor(t){let e=new URLSearchParams;for(let s of Object.getOwnPropertyNames(t))(t[s]||t[s]===0||!t[s]&&typeof t[s]=="boolean")&&e.append(s,t[s].toString());return[...e].length>0?`?${e.toString()}`:""}};var S=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return yield this.getRequest(`albums/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`albums${s}`)).albums})}tracks(t,e,s,a){let i=this.paramsFor({market:e,limit:s,offset:a});return this.getRequest(`albums/${t}/tracks${i}`)}};var T=class extends c{get(t){return r(this,null,function*(){if(typeof t=="string")return this.getRequest(`artists/${t}`);let e=this.paramsFor({ids:t});return(yield this.getRequest(`artists${e}`)).artists})}albums(t,e,s,a,i){let n=this.paramsFor({include_groups:e,market:s,limit:a,offset:i});return this.getRequest(`artists/${t}/albums${n}`)}topTracks(t,e){let s=this.paramsFor({market:e});return this.getRequest(`artists/${t}/top-tracks${s}`)}relatedArtists(t){return this.getRequest(`artists/${t}/related-artists`)}};var $=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return this.getRequest(`audiobooks/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`audiobooks${s}`)).audiobooks})}getAudiobookChapters(t,e,s,a){let i=this.paramsFor({market:e,limit:s,offset:a});return this.getRequest(`audiobooks/${t}/chapters${i}`)}};var q=class extends c{getCategories(t,e,s,a){let i=this.paramsFor({country:t,locale:e,limit:s,offset:a});return this.getRequest(`browse/categories${i}`)}getCategory(t,e,s){let a=this.paramsFor({country:e,locale:s});return this.getRequest(`browse/categories/${t}${a}`)}getNewReleases(t,e,s){let a=this.paramsFor({country:t,limit:e,offset:s});return this.getRequest(`browse/new-releases${a}`)}getFeaturedPlaylists(t,e,s,a,i){let n=this.paramsFor({country:t,locale:e,timestamp:s,limit:a,offset:i});return this.getRequest(`browse/featured-playlists${n}`)}getPlaylistsForCategory(t,e,s,a){let i=this.paramsFor({country:e,limit:s,offset:a});return this.getRequest(`browse/categories/${t}/playlists${i}`)}};var A=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return this.getRequest(`chapters/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`chapters${s}`)).chapters})}};var F=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return this.getRequest(`episodes/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`episodes${s}`)).episodes})}};var P=class extends c{get(t){let e=this.paramsFor(t);return this.getRequest(`recommendations${e}`)}genreSeeds(){return this.getRequest("recommendations/available-genre-seeds")}};var I=class extends c{getAvailableMarkets(){return this.getRequest("markets")}};var U=class extends c{getPlaybackState(t,e){let s=this.paramsFor({market:t,additional_types:e});return this.getRequest(`me/player${s}`)}getAvailableDevices(){return this.getRequest("me/player/devices")}getCurrentlyPlayingTrack(t,e){let s=this.paramsFor({market:t,additional_types:e});return this.getRequest(`me/player/currently-playing${s}`)}getRecentlyPlayedTracks(t,e){let s={limit:t};e&&(e.type==="before"?s.before=e.timestamp:e.type==="after"&&(s.after=e.timestamp));let a=this.paramsFor(s);return this.getRequest(`me/player/recently-played${a}`)}getUsersQueue(){return this.getRequest("me/player/queue")}transferPlayback(t,e){return r(this,null,function*(){if(t.length>1)throw new Error("Although an array is accepted, only a single device_id is currently supported. Supplying more than one will return 400 Bad Request");yield this.putRequest("me/player",{device_ids:t,play:e})})}startResumePlayback(t,e,s,a,i){return r(this,null,function*(){let n=this.paramsFor({device_id:t});yield this.putRequest(`me/player/play${n}`,{context_uri:e,uris:s,offset:a,positionMs:i})})}pausePlayback(t){return r(this,null,function*(){let e=this.paramsFor({device_id:t});yield this.putRequest(`me/player/pause${e}`)})}skipToNext(t){return r(this,null,function*(){let e=this.paramsFor({device_id:t});yield this.postRequest(`me/player/next${e}`)})}skipToPrevious(t){return r(this,null,function*(){let e=this.paramsFor({device_id:t});yield this.postRequest(`me/player/previous${e}`)})}seekToPosition(t,e){return r(this,null,function*(){let s=this.paramsFor({position_ms:t,device_id:e});yield this.putRequest(`me/player/seek${s}`)})}setRepeatMode(t,e){return r(this,null,function*(){let s=this.paramsFor({state:t,device_id:e});yield this.putRequest(`me/player/repeat${s}`)})}setPlaybackVolume(t,e){return r(this,null,function*(){let s=this.paramsFor({volume_percent:t,device_id:e});yield this.putRequest(`me/player/volume${s}`)})}togglePlaybackShuffle(t,e){return r(this,null,function*(){let s=this.paramsFor({state:t,device_id:e});yield this.putRequest(`me/player/shuffle${s}`)})}addItemToPlaybackQueue(t,e){return r(this,null,function*(){let s=this.paramsFor({uri:t,device_id:e});yield this.postRequest(`me/player/queue${s}`)})}};var D=class extends c{getPlaylist(t,e,s,a){let i=this.paramsFor({market:e,fields:s,additional_types:a?.join(",")});return this.getRequest(`playlists/${t}${i}`)}getPlaylistItems(t,e,s,a,i,n){let h=this.paramsFor({market:e,fields:s,limit:a,offset:i,additional_types:n?.join(",")});return this.getRequest(`playlists/${t}/tracks${h}`)}changePlaylistDetails(t,e){return r(this,null,function*(){yield this.putRequest(`playlists/${t}`,e)})}movePlaylistItems(t,e,s,a){return this.updatePlaylistItems(t,{range_start:e,range_length:s,insert_before:a})}updatePlaylistItems(t,e){return this.putRequest(`playlists/${t}/tracks`,e)}addItemsToPlaylist(t,e,s){return r(this,null,function*(){yield this.postRequest(`playlists/${t}/tracks`,{position:s,uris:e})})}removeItemsFromPlaylist(t,e){return r(this,null,function*(){yield this.deleteRequest(`playlists/${t}/tracks`,e)})}getUsersPlaylists(t,e,s){let a=this.paramsFor({limit:e,offset:s});return this.getRequest(`users/${t}/playlists${a}`)}createPlaylist(t,e){return this.postRequest(`users/${t}/playlists`,e)}getPlaylistCoverImage(t){return this.getRequest(`playlists/${t}/images`)}addCustomPlaylistCoverImage(t,e){return r(this,null,function*(){let s="";if(e instanceof Buffer)s=e.toString("base64");else if(e instanceof HTMLCanvasElement)s=e.toDataURL("image/jpeg").split(";base64,")[1];else if(e instanceof HTMLImageElement){let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");if(!i)throw new Error("Could not get canvas context");i.drawImage(e,0,0),s=a.toDataURL("image/jpeg").split(";base64,")[1]}else if(typeof e=="string")s=e;else throw new Error("ImageData must be a Buffer, HTMLImageElement, HTMLCanvasElement, or string containing a base64 encoded jpeg");yield this.addCustomPlaylistCoverImageFromBase64String(t,s)})}addCustomPlaylistCoverImageFromBase64String(t,e){return r(this,null,function*(){yield this.putRequest(`playlists/${t}/images`,e,"image/jpeg")})}};var E=class extends c{execute(t,e,s,a,i,n){return r(this,null,function*(){let h=this.paramsFor({q:t,type:e,market:s,limit:a,offset:i,include_external:n});return yield this.getRequest(`search${h}`)})}};var B=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return this.getRequest(`shows/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`shows${s}`)).shows})}episodes(t,e,s,a){let i=this.paramsFor({market:e,limit:s,offset:a});return this.getRequest(`shows/${t}/episodes${i}`)}};var L=class extends c{get(t,e){return r(this,null,function*(){if(typeof t=="string"){let i=this.paramsFor({market:e});return this.getRequest(`tracks/${t}${i}`)}let s=this.paramsFor({ids:t,market:e});return(yield this.getRequest(`tracks${s}`)).tracks})}audioFeatures(t){return r(this,null,function*(){if(typeof t=="string")return this.getRequest(`audio-features/${t}`);let e=this.paramsFor({ids:t});return(yield this.getRequest(`audio-features${e}`)).audio_features})}audioAnalysis(t){return this.getRequest(`audio-analysis/${t}`)}};var y={access_token:"emptyAccessToken",token_type:"",expires_in:0,refresh_token:"",expires:-1};function d(o){return o===y}var _=class extends c{profile(t){return this.getRequest(`users/${t}`)}};var j=class extends c{albums;audiobooks;episodes;playlists;shows;tracks;constructor(t){super(t),this.albums=new H(t),this.audiobooks=new V(t),this.episodes=new J(t),this.playlists=new W(t),this.shows=new K(t),this.tracks=new G(t)}profile(){return this.getRequest("me")}topItems(t,e,s,a){let i=this.paramsFor({time_range:e,limit:s,offset:a});return this.getRequest(`me/top/${t}${i}`)}followedArtists(t,e){let s=this.paramsFor({type:"artist",after:t,limit:e});return this.getRequest(`me/following${s}`)}followArtistsOrUsers(t,e){return r(this,null,function*(){let s=this.paramsFor({type:e});yield this.putRequest(`me/following${s}`,{ids:t})})}unfollowArtistsOrUsers(t,e){return r(this,null,function*(){let s=this.paramsFor({type:e});yield this.deleteRequest(`me/following${s}`,{ids:t})})}followsArtistsOrUsers(t,e){let s=this.paramsFor({ids:t,type:e});return this.getRequest(`me/following/contains${s}`)}};var H=class extends c{savedAlbums(t,e,s){let a=this.paramsFor({limit:t,offset:e,market:s});return this.getRequest(`me/albums${a}`)}saveAlbums(t){return r(this,null,function*(){yield this.putRequest("me/albums",t)})}removeSavedAlbums(t){return r(this,null,function*(){yield this.deleteRequest("me/albums",t)})}hasSavedAlbums(t){let e=this.paramsFor({ids:t});return this.getRequest(`me/albums/contains${e}`)}},V=class extends c{savedAudiobooks(t,e){let s=this.paramsFor({limit:t,offset:e});return this.getRequest(`me/audiobooks${s}`)}saveAudiobooks(t){return r(this,null,function*(){yield this.putRequest("me/audiobooks",t)})}removeSavedAudiobooks(t){return r(this,null,function*(){yield this.deleteRequest("me/audiobooks",t)})}hasSavedAudiobooks(t){let e=this.paramsFor({ids:t});return this.getRequest(`me/audiobooks/contains${e}`)}},J=class extends c{savedEpisodes(t,e,s){let a=this.paramsFor({market:t,limit:e,offset:s});return this.getRequest(`me/episodes${a}`)}saveEpisodes(t){return r(this,null,function*(){yield this.putRequest("me/episodes",t)})}removeSavedEpisodes(t){return r(this,null,function*(){yield this.deleteRequest("me/episodes",t)})}hasSavedEpisodes(t){let e=this.paramsFor({ids:t});return this.getRequest(`me/episodes/contains${e}`)}},W=class extends c{playlists(t,e){let s=this.paramsFor({limit:t,offset:e});return this.getRequest(`me/playlists${s}`)}follow(t){return r(this,null,function*(){yield this.putRequest(`playlists/${t}/followers`)})}unfollow(t){return r(this,null,function*(){yield this.deleteRequest(`playlists/${t}/followers`)})}isFollowing(t,e){let s=this.paramsFor({ids:e});return this.getRequest(`playlists/${t}/followers/contains${s}`)}},K=class extends c{savedShows(t,e){let s=this.paramsFor({limit:t,offset:e});return this.getRequest(`me/shows${s}`)}saveShows(t){let e=this.paramsFor({ids:t});return this.putRequest(`me/shows${e}`)}removeSavedShows(t,e){let s=this.paramsFor({ids:t,market:e});return this.deleteRequest(`me/shows${s}`)}hasSavedShow(t){let e=this.paramsFor({ids:t});return this.getRequest(`me/shows/contains${e}`)}},G=class extends c{savedTracks(t,e,s){let a=this.paramsFor({limit:t,offset:e,market:s});return this.getRequest(`me/tracks${a}`)}saveTracks(t){return r(this,null,function*(){yield this.putRequest("me/tracks",t)})}removeSavedTracks(t){return r(this,null,function*(){yield this.deleteRequest("me/tracks",t)})}hasSavedTracks(t){let e=this.paramsFor({ids:t});return this.getRequest(`me/tracks/contains${e}`)}};var O=class{static get current(){return this.hasSubtleCrypto?window.crypto:this.tryLoadNodeWebCrypto()}static get hasSubtleCrypto(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}static tryLoadNodeWebCrypto(){try{let{webcrypto:t}=re("crypto");return t}catch(t){throw t}}};var u=class o{static refreshCachedAccessToken(t,e){return r(this,null,function*(){let s=yield o.refreshToken(t,e.refresh_token);return o.toCachable(s)})}static toCachable(t){return t.expires&&t.expires===-1?t:C(l({},t),{expires:this.calculateExpiry(t)})}static calculateExpiry(t){return Date.now()+t.expires_in*1e3}static refreshToken(t,e){return r(this,null,function*(){let s=new URLSearchParams;s.append("client_id",t),s.append("grant_type","refresh_token"),s.append("refresh_token",e);let a=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),i=yield a.text();if(!a.ok)throw new Error(`Failed to refresh token: ${a.statusText}, ${i}`);return JSON.parse(i)})}static generateCodeVerifier(t){let e="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<t;a++)e+=s.charAt(Math.floor(Math.random()*s.length));return e}static generateCodeChallenge(t){return r(this,null,function*(){let e=new TextEncoder().encode(t),s=yield O.current.subtle.digest("SHA-256",e),a=[...new Uint8Array(s)];return(typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(String.fromCharCode.apply(null,a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}};var Q=(()=>{class o{clientId;clientSecret;scopes;static cacheKey="spotify-sdk:ClientCredentialsStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(e,s,a=[]){this.clientId=e,this.clientSecret=s,this.scopes=a}setConfiguration(e){this.configuration=e}getOrCreateAccessToken(){return r(this,null,function*(){return yield this.cache.getOrCreate(o.cacheKey,()=>r(this,null,function*(){let s=yield this.getTokenFromApi();return u.toCachable(s)}),s=>r(this,null,function*(){let a=yield this.getTokenFromApi();return u.toCachable(a)}))})}getAccessToken(){return r(this,null,function*(){return yield this.cache.get(o.cacheKey)})}removeAccessToken(){this.cache.remove(o.cacheKey)}getTokenFromApi(){return r(this,null,function*(){let e={grant_type:"client_credentials",scope:this.scopes.join(" ")},s=Object.keys(e).map(p=>p+"="+e[p]).join("&"),a=typeof Buffer<"u",i=`${this.clientId}:${this.clientSecret}`,n=a?Buffer.from(i).toString("base64"):btoa(i),h=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${n}`},body:s});if(h.status!==200)throw new Error("Failed to get access token.");return yield h.json()})}}return o})();var ae=(()=>{class o{clientId;redirectUri;scopes;static cacheKey="spotify-sdk:ImplicitGrantStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(e,s,a){this.clientId=e,this.redirectUri=s,this.scopes=a}setConfiguration(e){this.configuration=e}getOrCreateAccessToken(){return r(this,null,function*(){return yield this.cache.getOrCreate(o.cacheKey,()=>r(this,null,function*(){let s=yield this.redirectOrVerifyToken();return u.toCachable(s)}),s=>r(this,null,function*(){return u.refreshCachedAccessToken(this.clientId,s)}))})}getAccessToken(){return r(this,null,function*(){return yield this.cache.get(o.cacheKey)})}removeAccessToken(){this.cache.remove(o.cacheKey)}redirectOrVerifyToken(){return r(this,null,function*(){let e=new URLSearchParams(window.location.hash.substring(1)),s=e.get("access_token");if(s)return Promise.resolve({access_token:s,token_type:e.get("token_type")??"",expires_in:parseInt(e.get("expires_in")??"0"),refresh_token:e.get("refresh_token")??"",expires:Number(e.get("expires"))||0});var i=(this.scopes??[]).join(" ");let n=new URLSearchParams;n.append("client_id",this.clientId),n.append("response_type","token"),n.append("redirect_uri",this.redirectUri),n.append("scope",i);let h="https://accounts.spotify.com/authorize?"+n.toString();return this.configuration.redirectionStrategy.redirect(h),y})}}return o})();var M=(()=>{class o{clientId;redirectUri;scopes;static cacheKey="spotify-sdk:AuthorizationCodeWithPKCEStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(e,s,a){this.clientId=e,this.redirectUri=s,this.scopes=a}setConfiguration(e){this.configuration=e}getOrCreateAccessToken(){return r(this,null,function*(){return yield this.cache.getOrCreate(o.cacheKey,()=>r(this,null,function*(){let s=yield this.redirectOrVerifyToken();return u.toCachable(s)}),s=>r(this,null,function*(){return u.refreshCachedAccessToken(this.clientId,s)}))})}getAccessToken(){return r(this,null,function*(){return yield this.cache.get(o.cacheKey)})}removeAccessToken(){this.cache.remove(o.cacheKey)}redirectOrVerifyToken(){return r(this,null,function*(){let s=new URLSearchParams(window.location.search).get("code");if(s){let a=yield this.verifyAndExchangeCode(s);return this.removeCodeFromUrl(),a}return this.redirectToSpotify(),y})}redirectToSpotify(){return r(this,null,function*(){let e=u.generateCodeVerifier(128),s=yield u.generateCodeChallenge(e),a={verifier:e,expiresOnAccess:!0};this.cache.setCacheItem("spotify-sdk:verifier",a);let i=yield this.generateRedirectUrlForUser(this.scopes,s);yield this.configuration.redirectionStrategy.redirect(i)})}verifyAndExchangeCode(e){return r(this,null,function*(){let a=(yield this.cache.get("spotify-sdk:verifier"))?.verifier;if(!a)throw new Error("No verifier found in cache - can't validate query string callback parameters.");return yield this.configuration.redirectionStrategy.onReturnFromRedirect(),yield this.exchangeCodeForToken(e,a)})}removeCodeFromUrl(){let e=new URL(window.location.href);e.searchParams.delete("code");let s=e.search?e.href:e.href.replace("?","");window.history.replaceState({},document.title,s)}generateRedirectUrlForUser(e,s){return r(this,null,function*(){let a=e.join(" "),i=new URLSearchParams;return i.append("client_id",this.clientId),i.append("response_type","code"),i.append("redirect_uri",this.redirectUri),i.append("scope",a),i.append("code_challenge_method","S256"),i.append("code_challenge",s),`https://accounts.spotify.com/authorize?${i.toString()}`})}exchangeCodeForToken(e,s){return r(this,null,function*(){let a=new URLSearchParams;a.append("client_id",this.clientId),a.append("grant_type","authorization_code"),a.append("code",e),a.append("redirect_uri",this.redirectUri),a.append("code_verifier",s);let i=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}),n=yield i.text();if(!i.ok)throw new Error(`Failed to exchange code for token: ${i.statusText}, ${n}`);return JSON.parse(n)})}}return o})();var m=class{deserialize(t){return r(this,null,function*(){let e=yield t.text();return e.length>0?JSON.parse(e):null})}};var w=class{validateResponse(t){return r(this,null,function*(){switch(t.status){case 401:throw new Error("Bad or expired token. This can happen if the user revoked a token or the access token has expired. You should re-authenticate the user.");case 403:let e=yield t.text();throw new Error(`Bad OAuth request (wrong consumer key, bad nonce, expired timestamp...). Unfortunately, re-authenticating the user won't help here. Body: ${e}`);case 429:throw new Error("The app has exceeded its rate limits.");default:if(!t.status.toString().startsWith("20")){let s=yield t.text();throw new Error(`Unrecognised response code: ${t.status} - ${t.statusText}. Body: ${s}`)}}})}};var k=class{handleErrors(t){return r(this,null,function*(){return!1})}};var R=class{redirect(t){return r(this,null,function*(){document.location=t.toString()})}onReturnFromRedirect(){return r(this,null,function*(){})}};var f=class{storage;updateFunctions;autoRenewInterval;autoRenewWindow;constructor(t,e=new Map,s=0,a=2*60*1e3){this.storage=t,this.updateFunctions=e,this.autoRenewInterval=s,this.autoRenewWindow=a,this.autoRenewInterval>0&&setInterval(()=>this.autoRenewRenewableItems(),this.autoRenewInterval)}getOrCreate(t,e,s){return r(this,null,function*(){s&&this.updateFunctions.set(t,s);let a=yield this.get(t);if(a)return a;let i=yield e();if(!i)throw new Error("Could not create cache item");return d(i)||this.setCacheItem(t,i),i})}get(t){return r(this,null,function*(){let e=this.storage.get(t),s=e?JSON.parse(e):null;if(this.itemDueToExpire(s)&&this.updateFunctions.has(t)){let a=this.updateFunctions.get(t);yield this.tryUpdateItem(t,s,a),e=this.storage.get(t),s=e?JSON.parse(e):null}return s?s.expires&&(s.expires===-1||s.expires<=Date.now())?(this.remove(t),null):(s.expiresOnAccess&&s.expiresOnAccess===!0&&this.remove(t),s):null})}set(t,e,s){let a=Date.now()+s,i=C(l({},e),{expires:a});this.setCacheItem(t,i)}setCacheItem(t,e){let s=JSON.stringify(e);this.storage.set(t,s)}remove(t){this.storage.remove(t)}itemDueToExpire(t){return!t||!t.expires?!1:t.expires-Date.now()<this.autoRenewWindow}autoRenewRenewableItems(){return r(this,null,function*(){this.updateFunctions.forEach((t,e)=>r(this,null,function*(){let s=yield this.get(e);s&&t&&this.itemDueToExpire(s)&&(yield this.tryUpdateItem(e,s,t))}))})}tryUpdateItem(t,e,s){return r(this,null,function*(){try{let a=yield s(e);a&&this.setCacheItem(t,a)}catch(a){console.error(a)}})}};var b=class extends f{constructor(){super(new Y)}};var Y=class{get(t){return localStorage.getItem(t)}set(t,e){localStorage.setItem(t,e)}remove(t){localStorage.removeItem(t)}};var v=class extends f{constructor(){super(new X)}};var X=class{cache=new Map;get(t){return this.cache.get(t)??null}set(t,e){this.cache.set(t,e)}remove(t){this.cache.delete(t)}};var z=class{clientId;accessToken;refreshTokenAction;constructor(t,e,s){this.clientId=t,this.accessToken=e,this.refreshTokenAction=s||u.refreshCachedAccessToken,this.accessToken.expires||(this.accessToken.expires=u.calculateExpiry(this.accessToken))}setConfiguration(t){}getOrCreateAccessToken(){return r(this,null,function*(){if(this.accessToken.expires&&this.accessToken.expires<=Date.now()){let t=yield this.refreshTokenAction(this.clientId,this.accessToken);this.accessToken=t}return this.accessToken})}getAccessToken(){return r(this,null,function*(){return this.accessToken})}removeAccessToken(){this.accessToken={access_token:"",token_type:"",expires_in:0,refresh_token:"",expires:0}}};var Z=(()=>{class o{sdkConfig;static rootUrl="https://api.spotify.com/v1/";authenticationStrategy;albums;artists;audiobooks;browse;chapters;episodes;recommendations;markets;player;playlists;shows;tracks;users;search;currentUser;constructor(e,s){this.sdkConfig=this.initializeSdk(s),this.albums=new S(this),this.artists=new T(this),this.audiobooks=new $(this),this.browse=new q(this),this.chapters=new A(this),this.episodes=new F(this),this.recommendations=new P(this),this.markets=new I(this),this.player=new U(this),this.playlists=new D(this),this.shows=new B(this),this.tracks=new L(this),this.users=new _(this),this.currentUser=new j(this);let a=new E(this);this.search=a.execute.bind(a),this.authenticationStrategy=e,this.authenticationStrategy.setConfiguration(this.sdkConfig)}makeRequest(e,s,a=void 0,i=void 0){return r(this,null,function*(){try{let n=yield this.authenticationStrategy.getOrCreateAccessToken();if(d(n))return console.warn("No access token found, authenticating now."),null;let h=n?.access_token,g=o.rootUrl+s,p={method:e,headers:{Authorization:`Bearer ${h}`,"Content-Type":i??"application/json"},body:a?typeof a=="string"?a:JSON.stringify(a):void 0};this.sdkConfig.beforeRequest(g,p);let x=yield this.sdkConfig.fetch(g,p);return this.sdkConfig.afterRequest(g,p,x),x.status===204?null:(yield this.sdkConfig.responseValidator.validateResponse(x),this.sdkConfig.deserializer.deserialize(x))}catch(n){if(!(yield this.sdkConfig.errorHandler.handleErrors(n)))throw n;return null}})}initializeSdk(e){let s=typeof window<"u",a={fetch:(i,n)=>fetch(i,n),beforeRequest:(i,n)=>{},afterRequest:(i,n,h)=>{},deserializer:new m,responseValidator:new w,errorHandler:new k,redirectionStrategy:new R,cachingStrategy:s?new b:new v};return l(l({},a),e)}switchAuthenticationStrategy(e){this.authenticationStrategy=e,this.authenticationStrategy.setConfiguration(this.sdkConfig),this.authenticationStrategy.getOrCreateAccessToken()}authenticate(){return r(this,null,function*(){let e=yield this.authenticationStrategy.getOrCreateAccessToken();return{authenticated:e.expires>Date.now()&&!d(e),accessToken:e}})}getAccessToken(){return r(this,null,function*(){return this.authenticationStrategy.getAccessToken()})}logOut(){this.authenticationStrategy.removeAccessToken()}static withUserAuthorization(e,s,a=[],i){let n=new M(e,s,a);return new o(n,i)}static withClientCredentials(e,s,a=[],i){let n=new Q(e,s,a);return new o(n,i)}static withImplicitGrant(e,s,a=[],i){let n=new ae(e,s,a);return new o(n,i)}static withAccessToken(e,s,a){let i=new z(e,s);return new o(i,a)}static performUserAuthorization(e,s,a,i,n){return r(this,null,function*(){let h=new M(e,s,a),p=yield new o(h,n).authenticationStrategy.getOrCreateAccessToken();return d(p)||(typeof i=="string"?(console.log("Posting access token to postback URL."),yield fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})):yield i(p)),{authenticated:p.expires>Date.now()&&!d(p),accessToken:p}})}}return o})();var ie=["me/player/shuffle","me/player/repeat","me/player/pause","me/player/play","me/player/next","me/player/queue"],qs=(()=>{class o{constructor(){this.state=te(se),this.clientId=N.spotify.clientId,this.redirectUri=N.spotify.redirectUri,this.IsAuthenticated=!1,this.AvailableDevices=[],this.CurrentDevice=null,this.PlaybackState=null,this.sdk=Z.withUserAuthorization(this.clientId,this.redirectUri,["user-read-playback-state","user-modify-playback-state","playlist-read-private"],{deserializer:{deserialize:e=>r(this,null,function*(){return e.ok&&ie.some(s=>e.url.includes(s))?{}:new m().deserialize(e)})}}),this.sdk.getAccessToken().then(e=>{this.IsAuthenticated=!!e,this.IsAuthenticated&&(this.startPlaybackUpdater(),this.UpdateDeviceList(),this.state.CurrentDeviceId&&this.UpdateDeviceList().then(()=>{this.SetDevice(this.state.CurrentDeviceId,void 0)}))})}startPlaybackUpdater(){let e=setInterval(()=>r(this,null,function*(){if(!this.IsAuthenticated||!this.CurrentDevice){clearInterval(e);return}if(this.IsAuthenticated&&this.CurrentDevice&&this.state.MusicStarted&&(yield this.UpdatePlaybackState(),this.PlaybackState?.progress_ms&&this.PlaybackState?.item?.duration_ms)){let s=this.PlaybackState.item.duration_ms-this.PlaybackState.progress_ms;s+500<1e4&&setTimeout(()=>r(this,null,function*(){yield this.UpdatePlaybackState()}),s+500)}}),1e4)}Authenticate(){return r(this,null,function*(){return this.sdk.authenticate()})}UpdateAuthenticationState(){return r(this,null,function*(){try{let e=yield this.sdk.currentUser.profile();this.IsAuthenticated=!!e,this.IsAuthenticated&&(this.startPlaybackUpdater(),this.UpdateDeviceList())}catch{this.IsAuthenticated=!1}return this.IsAuthenticated})}Logout(){this.sdk.logOut(),this.IsAuthenticated=!1}UpdateDeviceList(){return r(this,null,function*(){if(this.checkAuthentication())try{this.AvailableDevices=(yield this.sdk.player.getAvailableDevices()).devices}catch(e){console.error(e),this.AvailableDevices=[]}})}SetDevice(e,s){return r(this,null,function*(){!this.checkCurrentDevice(e)||!this.checkAuthentication()||(yield this.sdk.player.transferPlayback([e],s),this.CurrentDevice=this.AvailableDevices.find(a=>a.id===e)??null,this.state.CurrentDeviceId=e,yield this.UpdatePlaybackState())})}UpdatePlaybackState(){return r(this,null,function*(){if(this.checkAuthentication())try{this.PlaybackState=yield this.sdk.player.getPlaybackState()}catch(e){console.error(e),this.PlaybackState=null}})}PlayPlaylist(e,s=!0){return r(this,null,function*(){!this.checkCurrentDevice(this.CurrentDevice?.id)||!this.checkAuthentication()||(yield this.sdk.player.setRepeatMode("context",this.CurrentDevice.id),yield this.sdk.player.togglePlaybackShuffle(s,this.CurrentDevice.id),yield this.sdk.player.startResumePlayback(this.CurrentDevice.id,`spotify:playlist:${e}`),yield this.UpdatePlaybackState())})}Pause(){return r(this,null,function*(){!this.checkCurrentDevice(this.CurrentDevice?.id)||!this.checkAuthentication()||(yield this.sdk.player.pausePlayback(this.CurrentDevice.id))})}Resume(){return r(this,null,function*(){!this.checkCurrentDevice(this.CurrentDevice?.id)||!this.checkAuthentication()||(yield this.sdk.player.startResumePlayback(this.CurrentDevice.id))})}SkipSong(){return r(this,null,function*(){!this.checkCurrentDevice(this.CurrentDevice?.id)||!this.checkAuthentication()||(yield this.sdk.player.skipToNext(this.CurrentDevice.id))})}QueueSongRandom(e){return r(this,null,function*(){if(!this.checkCurrentDevice(this.CurrentDevice?.id)||!this.checkAuthentication())return;let s=(yield this.sdk.playlists.getPlaylistItems(e)).items,a=s[Math.floor(Math.random()*s.length)].track;yield this.sdk.player.addItemToPlaybackQueue(a.uri,this.CurrentDevice.id)})}getIconOfDevice(e){switch(e.type.toLowerCase()){case"computer":return"laptop";case"smartphone":return"smartphone";case"tablet":return"tablet";case"tv":return"tv";case"automobile":return"car-front";default:return"speaker"}}checkAuthentication(){return this.IsAuthenticated?!0:(this.CurrentDevice=null,this.state.CurrentDeviceId=void 0,this.state.MusicStarted=!1,!1)}checkCurrentDevice(e){return e?!0:(this.CurrentDevice=null,this.state.CurrentDeviceId=void 0,this.state.MusicStarted=!1,!1)}static{this.\u0275fac=function(s){return new(s||o)}}static{this.\u0275prov=ee({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{qs as a};
/**i18n:4d237bd4a7924989e9147be91c316aeb32cdd902c29b123d66e18fd31eb96ec1*/
